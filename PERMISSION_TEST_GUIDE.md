# 권한 시스템 테스트 가이드

## 📋 개요
각 역할(ADMIN, MANAGER, COACH, FRONT)별로 권한이 올바르게 작동하는지 확인하는 가이드입니다.

---

## 🔐 역할별 기본 권한 설정

### 1. ADMIN (관리자)
**모든 권한 보유**

| 권한 카테고리 | 조회 | 등록 | 수정 | 삭제 |
|------------|------|------|------|------|
| 대시보드 | ✅ | - | - | - |
| 회원 관리 | ✅ | ✅ | ✅ | ✅ |
| 예약 관리 | ✅ | ✅ | ✅ | ✅ |
| 코치 관리 | ✅ | ✅ | ✅ | ✅ |
| 상품 관리 | ✅ | ✅ | ✅ | ✅ |
| 결제 관리 | ✅ | ✅ | ✅ | ✅ (환불) |
| 통계/분석 | ✅ | - | - | - |
| 설정 관리 | ✅ | - | ✅ | - |
| 사용자 관리 | ✅ | ✅ | ✅ | ✅ |
| 공지사항 | ✅ | ✅ | ✅ | ✅ |
| 출석 관리 | ✅ | - | ✅ | - |
| 훈련 기록 | ✅ | ✅ | ✅ | - |

**접근 가능한 메뉴:**
- ✅ 모든 메뉴 접근 가능

---

### 2. MANAGER (매니저)
**관리 기능 중심**

| 권한 카테고리 | 조회 | 등록 | 수정 | 삭제 |
|------------|------|------|------|------|
| 대시보드 | ✅ | - | - | - |
| 회원 관리 | ✅ | ✅ | ✅ | ❌ |
| 예약 관리 | ✅ | ✅ | ✅ | ✅ |
| 코치 관리 | ✅ | ✅ | ✅ | ❌ |
| 상품 관리 | ✅ | ✅ | ✅ | ❌ |
| 결제 관리 | ✅ | ✅ | ❌ | ✅ (환불) |
| 통계/분석 | ✅ | - | - | - |
| 설정 관리 | ✅ | - | ❌ | - |
| 사용자 관리 | ❌ | ❌ | ❌ | ❌ |
| 공지사항 | ✅ | ✅ | ✅ | ❌ |
| 출석 관리 | ✅ | - | ✅ | - |
| 훈련 기록 | ✅ | ❌ | ❌ | - |

**접근 가능한 메뉴:**
- ✅ 대시보드
- ✅ 회원 관리
- ✅ 예약 관리 (모든 지점)
- ✅ 코치/레슨 관리
- ✅ 상품/이용권
- ✅ 결제/정산
- ✅ 시설/슬롯 설정
- ✅ 통계/분석
- ✅ 공지/메시지
- ✅ 출석/이용 기록
- ❌ 사용자 관리
- ❌ 권한 관리
- ❌ 설정

---

### 3. COACH (코치)
**코치 관련 기능 중심**

| 권한 카테고리 | 조회 | 등록 | 수정 | 삭제 |
|------------|------|------|------|------|
| 대시보드 | ✅ | - | - | - |
| 회원 관리 | ✅ | ❌ | ❌ | ❌ |
| 예약 관리 | ✅ | ❌ | ❌ | ❌ |
| 코치 관리 | ✅ | ❌ | ❌ | ❌ |
| 상품 관리 | ❌ | ❌ | ❌ | ❌ |
| 결제 관리 | ❌ | ❌ | ❌ | ❌ |
| 통계/분석 | ❌ | - | - | - |
| 설정 관리 | ❌ | - | ❌ | - |
| 사용자 관리 | ❌ | ❌ | ❌ | ❌ |
| 공지사항 | ✅ | ❌ | ❌ | ❌ |
| 출석 관리 | ✅ | - | ✅ | - |
| 훈련 기록 | ✅ | ✅ | ✅ | - |

**접근 가능한 메뉴:**
- ✅ 대시보드
- ✅ 회원 관리 (조회만)
- ✅ 예약 관리 (조회만)
- ✅ 코치/레슨 관리 (조회만)
- ✅ 공지/메시지 (조회만)
- ✅ 출석/이용 기록
- ✅ 훈련 기록
- ✅ 훈련 랭킹
- ✅ 훈련 통계
- ❌ 상품/이용권
- ❌ 결제/정산
- ❌ 시설/슬롯 설정
- ❌ 통계/분석
- ❌ 사용자 관리
- ❌ 권한 관리
- ❌ 설정

---

### 4. FRONT (데스크)
**기본 업무 기능**

| 권한 카테고리 | 조회 | 등록 | 수정 | 삭제 |
|------------|------|------|------|------|
| 대시보드 | ✅ | - | - | - |
| 회원 관리 | ✅ | ✅ | ✅ | ❌ |
| 예약 관리 | ✅ | ✅ | ✅ | ✅ |
| 코치 관리 | ✅ | ❌ | ❌ | ❌ |
| 상품 관리 | ✅ | ❌ | ❌ | ❌ |
| 결제 관리 | ✅ | ✅ | ❌ | ❌ |
| 통계/분석 | ❌ | - | - | - |
| 설정 관리 | ❌ | - | ❌ | - |
| 사용자 관리 | ❌ | ❌ | ❌ | ❌ |
| 공지사항 | ✅ | ❌ | ❌ | ❌ |
| 출석 관리 | ✅ | - | ✅ | - |
| 훈련 기록 | ❌ | ❌ | ❌ | - |

**접근 가능한 메뉴:**
- ✅ 대시보드
- ✅ 회원 관리
- ✅ 예약 관리 (모든 지점)
- ✅ 코치/레슨 관리 (조회만)
- ✅ 상품/이용권 (조회만)
- ✅ 결제/정산 (결제 처리만)
- ✅ 공지/메시지 (조회만)
- ✅ 출석/이용 기록
- ❌ 시설/슬롯 설정
- ❌ 통계/분석
- ❌ 사용자 관리
- ❌ 권한 관리
- ❌ 설정
- ❌ 훈련 기록
- ❌ 훈련 랭킹
- ❌ 훈련 통계

---

## 🧪 테스트 방법

### 1. 권한 데이터 확인
브라우저 콘솔에서 다음 명령어 실행:
```javascript
// 권한 데이터 로드
await App.loadRolePermissions();
console.log('현재 권한:', App.currentRole);
console.log('권한 데이터:', App.rolePermissions);

// 특정 권한 체크
App.hasDetailPermission('memberView');
App.hasDetailPermission('userView');
```

### 2. 메뉴 표시 확인
각 역할로 로그인 후 다음을 확인:
- ✅ 권한이 있는 메뉴는 표시되어야 함
- ❌ 권한이 없는 메뉴는 숨겨져야 함
- ❌ 권한이 없는 메뉴는 클릭 불가능해야 함

### 3. 페이지 접근 확인
직접 URL로 접근 시도:
- 권한이 있으면: 페이지 정상 표시
- 권한이 없으면: 접근 제한 또는 리다이렉트

### 4. API 호출 확인
브라우저 개발자 도구 Network 탭에서:
- 권한이 있는 API: 정상 응답 (200)
- 권한이 없는 API: 401 Unauthorized 또는 403 Forbidden

---

## 🔍 권한 체크 로직

### 프론트엔드 권한 체크
```javascript
// 1. 세부 권한 체크 (권한 데이터가 있을 때)
App.hasDetailPermission('memberView')

// 2. 역할 계층 체크 (권한 데이터가 없을 때)
App.hasPermission('Manager') // ADMIN >= MANAGER

// 3. 메뉴 필터링
App.filterMenuByRole()
```

### 권한 우선순위
1. **세부 권한** (권한 데이터가 있을 때)
   - `data-permission` 속성 또는 `menuPermissionMap`의 권한 체크
2. **역할 계층** (권한 데이터가 없을 때)
   - ADMIN (4) > MANAGER (3) > COACH (2) > FRONT (1)

---

## ⚠️ 주의사항

1. **권한 데이터가 없을 때**
   - 기본 역할 계층만 체크
   - 모든 ADMIN은 모든 메뉴 접근 가능

2. **권한 데이터가 있을 때**
   - 세부 권한을 정확히 체크
   - ADMIN이라도 권한이 false면 접근 불가

3. **권한 변경 후**
   - 페이지 새로고침 필요
   - 권한 데이터 재로드 필요

---

## 📝 테스트 체크리스트

### ADMIN 계정 테스트
- [ ] 모든 메뉴 표시 확인
- [ ] 모든 페이지 접근 가능 확인
- [ ] 모든 API 호출 가능 확인
- [ ] 권한 관리 페이지 접근 가능 확인

### MANAGER 계정 테스트
- [ ] 사용자 관리 메뉴 숨김 확인
- [ ] 권한 관리 메뉴 숨김 확인
- [ ] 설정 메뉴 숨김 확인
- [ ] 통계/분석 메뉴 표시 확인
- [ ] 결제 환불 가능 확인

### COACH 계정 테스트
- [ ] 상품/결제 메뉴 숨김 확인
- [ ] 통계/분석 메뉴 숨김 확인
- [ ] 사용자 관리 메뉴 숨김 확인
- [ ] 훈련 기록 메뉴 표시 확인
- [ ] 회원 조회만 가능 확인

### FRONT 계정 테스트
- [ ] 훈련 관련 메뉴 숨김 확인
- [ ] 통계/분석 메뉴 숨김 확인
- [ ] 사용자 관리 메뉴 숨김 확인
- [ ] 예약 관리 메뉴 표시 확인
- [ ] 결제 처리 가능 확인

---

## 🐛 문제 해결

### 메뉴가 보이지 않는 경우
1. 브라우저 콘솔 확인: 권한 데이터 로드 여부
2. 권한 관리 페이지 확인: 해당 역할의 권한 설정
3. 페이지 새로고침: 권한 데이터 재로드

### 권한이 있어도 접근 불가한 경우
1. JWT 토큰 확인: 유효한 토큰인지 확인
2. 권한 데이터 확인: `App.rolePermissions` 확인
3. 콘솔 로그 확인: 권한 체크 로그 확인

---

**작성일**: 2026-01-25
**버전**: 1.0
