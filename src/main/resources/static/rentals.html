<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">`n    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <title>대관 관리 - AFBS 센터</title>
    <link rel="stylesheet" href="/css/common.css">
    <link rel="stylesheet" href="/css/rentals.css">
</head>
<body>
    <div class="app-container">
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-logo">⚾ AFBS 센터</div>
                <div class="sidebar-subtitle">운영 관리 시스템</div>
            </div>
            <nav class="sidebar-menu">
                <div class="menu-section">
                    <div class="menu-section-title">주요 메뉴</div>
                    <a href="/" class="menu-item" data-role="Front"><span class="menu-item-icon">📊</span><span>대시보드</span></a>
                </div>
                <div class="menu-section">
                    <div class="menu-section-title">회원 관리</div>
                    <a href="/members.html" class="menu-item" data-role="Front"><span class="menu-item-icon">👥</span><span>회원 관리</span></a>
                    <a href="/coaches.html" class="menu-item" data-role="Manager"><span class="menu-item-icon">🏃</span><span>코치/레슨 관리</span></a>
                </div>
                <div class="menu-section">
                    <div class="menu-section-title">예약 관리</div>
                    
                    <!-- 사하점 -->
                    <div style="margin-left: 12px; margin-top: 8px; margin-bottom: 4px; font-size: 11px; color: var(--text-secondary); font-weight: 600;">📍 사하점</div>
                    <a href="/bookings.html" class="menu-item" data-role="Front"><span class="menu-item-icon">⚾</span><span>야구</span></a>
                    <a href="/bookings-saha-training.html" class="menu-item" data-role="Front"><span class="menu-item-icon">💪</span><span>트레이닝+필라테스</span></a>
                    
                    <!-- 연산점 -->
                    <div style="margin-left: 12px; margin-top: 12px; margin-bottom: 4px; font-size: 11px; color: var(--text-secondary); font-weight: 600;">📍 연산점</div>
                    <a href="/bookings-yeonsan.html" class="menu-item" data-role="Front"><span class="menu-item-icon">⚾</span><span>야구</span></a>
                    <a href="/bookings-yeonsan-training.html" class="menu-item" data-role="Front"><span class="menu-item-icon">💪</span><span>트레이닝+필라테스</span></a>
                    
                    <!-- 대관 -->
                    <div style="margin-left: 12px; margin-top: 12px; margin-bottom: 4px; font-size: 11px; color: var(--text-secondary); font-weight: 600;">🏟️ 대관</div>
                    <a href="/rentals.html" class="menu-item active" data-role="Front"><span class="menu-item-icon">🏟️</span><span>대관 관리</span></a>
                    
                    <a href="/attendance.html" class="menu-item" data-role="Front" style="margin-top: 12px;"><span class="menu-item-icon">✓</span><span>출석/이용 기록</span></a>
                </div>
                <div class="menu-section">
                    <div class="menu-section-title">훈련 관리</div>
                    <a href="/training-logs.html" class="menu-item" data-role="Coach"><span class="menu-item-icon">📝</span><span>훈련 기록</span></a>
                    <a href="/rankings.html" class="menu-item" data-role="Coach"><span class="menu-item-icon">🏆</span><span>훈련 랭킹</span></a>
                    <a href="/training-stats.html" class="menu-item" data-role="Coach"><span class="menu-item-icon">📈</span><span>훈련 통계</span></a>
                </div>
            </nav>
        </aside>
        
        <main class="main-content">
            <header class="topbar">
                <div class="topbar-left">
                    <h1 class="page-title">대관 관리</h1>
                    <div class="search-box">
                        <input type="text" placeholder="검색..." id="global-search">
                    </div>
                </div>
                <div class="topbar-right">
                    <button class="notification-btn">🔔</button>
                    <button class="user-menu-btn">👤</button>
                </div>
            </header>
            
            <div class="content-area">
                <!-- 뷰 전환 버튼 -->
                <div class="view-controls">
                    <button class="btn btn-secondary active" data-view="calendar" id="btn-calendar">달력</button>
                    <button class="btn btn-secondary" data-view="list" id="btn-list">목록</button>
                    <button class="btn btn-secondary" onclick="openBookingModal()" id="btn-booking-new">대관 등록</button>
                </div>
                <!-- 코치 범례 -->
                <div id="coach-legend" class="coach-legend"></div>
                
                <!-- 필터 -->
                <div class="card">
                    <div class="filter-group">
                        <select class="form-control" id="filter-facility" style="width: 200px;">
                            <option value="">전체 시설</option>
                            <option value="1">배팅케이지</option>
                            <option value="2">피칭머신존</option>
                            <option value="3">실내구장</option>
                            <option value="4">레슨룸</option>
                        </select>
                        <select class="form-control" id="filter-status" style="width: 150px;">
                            <option value="">전체 상태</option>
                            <option value="CONFIRMED">확정</option>
                            <option value="PENDING">대기</option>
                            <option value="CANCELLED">취소</option>
                            <option value="COMPLETED">완료</option>
                        </select>
                        <input type="date" class="form-control" id="filter-date-start" style="width: 150px;">
                        <input type="date" class="form-control" id="filter-date-end" style="width: 150px;">
                        <button class="btn btn-secondary" onclick="applyFilters()">적용</button>
                    </div>
                </div>
                
                <!-- 달력 뷰 -->
                <div id="calendar-view" class="view-container active">
                    <div class="calendar-container">
                        <div class="calendar-header">
                            <button class="btn btn-secondary btn-sm" onclick="changeMonth(-1)">◀</button>
                            <h2 id="calendar-month-year"></h2>
                            <button class="btn btn-secondary btn-sm" onclick="changeMonth(1)">▶</button>
                        </div>
                        <div id="calendar-grid" class="calendar-grid"></div>
                    </div>
                </div>
                
                <!-- 목록 뷰 -->
                <div id="list-view" class="view-container">
                    <div class="table-container">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>날짜</th>
                                    <th>시간</th>
                                    <th>시설</th>
                                    <th>회원</th>
                                    <th>인원</th>
                                    <th>상태</th>
                                    <th>작업</th>
                                </tr>
                            </thead>
                            <tbody id="bookings-table-body">
                            </tbody>
                        </table>
                    </div>
                    <div id="pagination-container" class="pagination"></div>
                </div>
            </div>
        </main>
    </div>
    
    <!-- 회원 선택 모달 (날짜 클릭 시) -->
    <div class="modal-overlay" id="member-select-modal">
        <div class="modal" style="max-width: 1000px; width: 90vw;">
            <div class="modal-header">
                <h2 class="modal-title">회원 선택</h2>
                <button class="modal-close">×</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <input type="text" class="form-control" id="member-search-input" placeholder="회원 이름 또는 전화번호로 검색..." style="margin-bottom: 16px;">
                </div>
                <div class="table-container" style="max-height: 600px; overflow-y: auto;">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>이름</th>
                                <th>회원번호</th>
                                <th>전화번호</th>
                                <th>등급</th>
                                <th>학교/소속</th>
                                <th>작업</th>
                            </tr>
                        </thead>
                        <tbody id="member-select-table-body">
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="openNonMemberBookingModal()">비회원 예약</button>
                <button class="btn btn-secondary" onclick="App.Modal.close('member-select-modal')">취소</button>
            </div>
        </div>
    </div>
    
    <!-- 예약 등록/수정 모달 -->
    <div class="modal-overlay" id="booking-modal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title" id="booking-modal-title">대관 등록</h2>
                <button class="modal-close">×</button>
            </div>
            <div class="modal-body">
                <form id="booking-form">
                    <input type="hidden" id="booking-id">
                    <input type="hidden" id="selected-member-id">
                    <input type="hidden" id="selected-member-number">
                    
                    <!-- 회원 정보 표시 영역 -->
                    <div id="member-info-section" style="display: none;">
                        <div class="form-group">
                            <label class="form-label">회원 정보</label>
                            <div style="padding: 12px; background: var(--bg-tertiary); border-radius: var(--radius-md); border: 1px solid var(--border-color);">
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                                    <div>
                                        <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: 4px;">이름</div>
                                        <div style="font-weight: 600; color: var(--text-primary);" id="member-info-name">-</div>
                                    </div>
                                    <div>
                                        <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: 4px;">전화번호</div>
                                        <div style="color: var(--text-primary);" id="member-info-phone">-</div>
                                    </div>
                                    <div>
                                        <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: 4px;">등급</div>
                                        <div style="color: var(--text-primary);" id="member-info-grade">-</div>
                                    </div>
                                    <div>
                                        <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: 4px;">학교/소속</div>
                                        <div style="color: var(--text-primary);" id="member-info-school">-</div>
                                    </div>
                                </div>
                            </div>
                            <button type="button" class="btn btn-secondary btn-sm" onclick="changeMember()" style="margin-top: 8px; width: 100%;">회원 변경</button>
                        </div>
                        <div class="form-group">
                            <label class="form-label">사용할 상품/이용권</label>
                            <select class="form-control" id="booking-member-product">
                                <option value="">상품 미선택 (일반 예약)</option>
                            </select>
                            <small style="color: var(--text-muted); font-size: 12px; display: block; margin-top: 4px;">상품을 선택하면 선결제로 처리되며, 횟수권은 자동으로 차감됩니다</small>
                            <div id="product-info" style="margin-top: 8px; padding: 8px; background: var(--bg-tertiary); border-radius: var(--radius-sm); display: none;">
                                <div style="font-size: 12px; color: var(--text-secondary);" id="product-info-text"></div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 비회원 정보 입력 영역 -->
                    <div id="non-member-section" style="display: none;">
                        <div class="form-group">
                            <label class="form-label">비회원 이름 <span style="color: var(--danger);">*</span></label>
                            <input type="text" class="form-control" id="booking-non-member-name" placeholder="비회원 이름" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">비회원 연락처 <span style="color: var(--danger);">*</span></label>
                            <input type="text" class="form-control" id="booking-phone" placeholder="010-0000-0000" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">담당 코치</label>
                            <select class="form-control" id="booking-coach-nonmember">
                                <option value="">코치 미지정</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- 대관용 간단한 회원 정보 입력 -->
                    <div id="member-select-section">
                        <div class="form-group">
                            <label class="form-label">예약자 이름 <span style="color: var(--danger);">*</span></label>
                            <input type="text" class="form-control" id="booking-renter-name" placeholder="예약자 이름 입력" required>
                            <small style="color: var(--text-muted); font-size: 12px; display: block; margin-top: 4px;">대관 예약자 이름을 입력해주세요</small>
                        </div>
                        <div class="form-group">
                            <label class="form-label">연락처</label>
                            <input type="text" class="form-control" id="booking-renter-phone" placeholder="010-0000-0000">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">시설 <span style="color: var(--danger);">*</span></label>
                        <select class="form-control" id="booking-facility" required>
                            <option value="">시설 선택...</option>
                        </select>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">날짜 <span style="color: var(--danger);">*</span></label>
                            <input type="date" class="form-control" id="booking-date" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">시작 시간 <span style="color: var(--danger);">*</span></label>
                            <input type="text" class="form-control" id="booking-start-time" required placeholder="예: 14:00" pattern="([01]?[0-9]|2[0-3]):[0-5][0-9]" maxlength="5">
                            <small style="color: var(--text-muted); font-size: 11px;">24시간 형식 (예: 14:00)</small>
                        </div>
                        <div class="form-group">
                            <label class="form-label">종료 시간 <span style="color: var(--danger);">*</span></label>
                            <input type="text" class="form-control" id="booking-end-time" required placeholder="예: 16:00" pattern="([01]?[0-9]|2[0-3]):[0-5][0-9]" maxlength="5">
                            <small style="color: var(--text-muted); font-size: 11px;">24시간 형식 (예: 16:00)</small>
                        </div>
                    </div>
                    
                    <!-- 반복 예약 옵션 -->
                    <div class="form-group">
                        <label class="form-label">
                            <input type="checkbox" id="booking-repeat-enabled" onchange="toggleRepeatOptions()">
                            반복 예약
                        </label>
                    </div>
                    <div id="repeat-options" style="display: none;">
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">반복 주기</label>
                                <select class="form-control" id="booking-repeat-type">
                                    <option value="DAILY">매일</option>
                                    <option value="WEEKLY" selected>매주</option>
                                    <option value="MONTHLY">매월</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">반복 횟수</label>
                                <input type="number" class="form-control" id="booking-repeat-count" min="1" max="52" value="4" placeholder="예: 4">
                            </div>
                        </div>
                        <div class="form-group">
                            <small style="color: var(--text-muted); font-size: 12px;">
                                선택한 날짜부터 지정한 주기와 횟수만큼 자동으로 예약이 생성됩니다.
                            </small>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">인원 <span style="color: var(--danger);">*</span></label>
                        <input type="number" class="form-control" id="booking-participants" min="1" value="1" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">목적 <span style="color: var(--danger);">*</span></label>
                        <select class="form-control" id="booking-purpose" required onchange="toggleLessonCategory()">
                            <option value="">목적 선택...</option>
                            <option value="LESSON">레슨</option>
                            <option value="RENTAL">대관</option>
                            <option value="PERSONAL_TRAINING">개인훈련</option>
                        </select>
                    </div>
                    <div class="form-group" id="lesson-category-group" style="display: none;">
                        <label class="form-label">레슨 종목 <span style="color: var(--danger);">*</span></label>
                        <select class="form-control" id="booking-lesson-category" required>
                            <option value="">레슨 종목 선택...</option>
                            <option value="BASEBALL">야구</option>
                            <option value="PILATES">필라테스</option>
                            <option value="TRAINING">트레이닝</option>
                        </select>
                    </div>
                    <!-- 대관에서는 코치 필드 숨김 -->
                    <div class="form-group" id="coach-group" style="display: none;">
                        <label class="form-label">담당 코치</label>
                        <select class="form-control" id="booking-coach">
                            <option value="">코치 미지정</option>
                        </select>
                        <small style="color: var(--text-muted); font-size: 12px; display: block; margin-top: 4px;">레슨인 경우 코치 선택을 권장합니다</small>
                    </div>
                    <div class="form-group">
                        <label class="form-label">상태 *</label>
                        <select class="form-control" id="booking-status" required>
                            <option value="PENDING">대기</option>
                            <option value="CONFIRMED">확정</option>
                            <option value="CANCELLED">취소</option>
                            <option value="NO_SHOW">노쇼</option>
                            <option value="COMPLETED">완료</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">결제 방식</label>
                        <select class="form-control" id="booking-payment-method">
                            <option value="">결제 방법 선택...</option>
                            <option value="PREPAID">선결제</option>
                            <option value="ON_SITE">현장</option>
                            <option value="POSTPAID">후불</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">메모</label>
                        <div style="position: relative;">
                            <textarea class="form-control" id="booking-notes" rows="3"></textarea>
                            <div style="position: absolute; top: 4px; right: 4px; display: flex; gap: 4px;">
                                <button type="button" class="btn btn-sm btn-secondary" onclick="openMemoTemplates()" title="메모 템플릿 관리" style="padding: 4px 8px; font-size: 11px;">템플릿</button>
                                <button type="button" class="btn btn-sm btn-secondary" onclick="copyMemoToClipboard()" title="메모 복사" style="padding: 4px 8px; font-size: 11px;">복사</button>
                            </div>
                        </div>
                        <div id="copied-memo-display" style="margin-top: 8px; padding: 8px; background: var(--bg-tertiary); border-radius: var(--radius-sm); display: none;">
                            <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: 4px;">복사된 메모:</div>
                            <div id="copied-memo-content" style="font-size: 13px; color: var(--text-primary); white-space: pre-wrap;"></div>
                            <button type="button" class="btn btn-sm btn-secondary" onclick="pasteCopiedMemo()" style="margin-top: 4px; padding: 2px 8px; font-size: 11px;">붙여넣기</button>
                            <button type="button" class="btn btn-sm btn-danger" onclick="clearCopiedMemo()" style="margin-top: 4px; margin-left: 4px; padding: 2px 8px; font-size: 11px;">삭제</button>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-danger" id="booking-delete-btn" onclick="deleteBookingFromModal()" style="display: none; margin-right: auto;">삭제</button>
                <button class="btn btn-secondary" onclick="App.Modal.close('booking-modal')">취소</button>
                <button class="btn btn-primary" onclick="saveBooking()">저장</button>
            </div>
        </div>
    </div>
    
    <!-- 빠른 예약 모달 (대관용) -->
    <div class="modal-overlay" id="quick-booking-modal">
        <div class="modal" style="max-width: 500px;">
            <div class="modal-header">
                <h2 class="modal-title" id="quick-booking-title">대관 등록</h2>
                <button class="modal-close">×</button>
            </div>
            <div class="modal-body">
                <form id="quick-booking-form">
                    <input type="hidden" id="quick-booking-date">
                    <input type="hidden" id="quick-booking-id">
                    
                    <div class="form-group">
                        <label class="form-label">이름 <span style="color: var(--danger);">*</span></label>
                        <input type="text" class="form-control" id="quick-name" placeholder="이름 입력" required autofocus>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">시작 시간 <span style="color: var(--danger);">*</span></label>
                            <input type="text" class="form-control" id="quick-start-time" required placeholder="14:00" pattern="([01]?[0-9]|2[0-3]):[0-5][0-9]" maxlength="5">
                            <small style="color: var(--text-muted); font-size: 11px;">24시간 형식 (0~23시)</small>
                        </div>
                        <div class="form-group">
                            <label class="form-label">종료 시간 <span style="color: var(--danger);">*</span></label>
                            <input type="text" class="form-control" id="quick-end-time" required placeholder="16:00" pattern="([01]?[0-9]|2[0-3]):[0-5][0-9]" maxlength="5">
                            <small style="color: var(--text-muted); font-size: 11px;">24시간 형식 (0~23시)</small>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">시설 <span style="color: var(--danger);">*</span></label>
                        <select class="form-control" id="quick-facility" required>
                            <option value="">시설 선택...</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">목적 <span style="color: var(--danger);">*</span></label>
                        <select class="form-control" id="quick-purpose" required disabled style="background-color: var(--bg-secondary); color: var(--text-muted);">
                            <option value="RENTAL" selected>대관</option>
                        </select>
                        <small style="color: var(--text-muted); font-size: 11px;">대관 등록입니다</small>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">전화번호</label>
                        <input type="text" class="form-control" id="quick-phone" placeholder="010-0000-0000">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">메모</label>
                        <textarea class="form-control" id="quick-memo" rows="2" placeholder="예: 2명, 배팅연습"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-danger" id="quick-booking-delete-btn" onclick="deleteQuickBooking()" style="display: none; margin-right: auto;">삭제</button>
                <button class="btn btn-secondary" onclick="App.Modal.close('quick-booking-modal')">취소</button>
                <button class="btn btn-secondary" onclick="openDetailBookingModal()">상세 입력</button>
                <button class="btn btn-primary" onclick="saveQuickBooking()">저장</button>
            </div>
        </div>
    </div>
    
    <!-- 날짜별 스케줄 모달 -->
    <div class="modal-overlay" id="day-schedule-modal">
        <div class="modal" style="max-width: 900px;">
            <div class="modal-header">
                <h2 class="modal-title" id="day-schedule-modal-title">날짜별 스케줄</h2>
                <button class="modal-close">×</button>
            </div>
            <div class="modal-body">
                <div class="form-group" style="margin-bottom: 20px;">
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <label class="form-label" style="margin: 0;">필터:</label>
                        <select class="form-control" id="schedule-filter-coach" style="width: 200px;" onchange="filterDaySchedule()">
                            <option value="">전체 코치</option>
                        </select>
                        <select class="form-control" id="schedule-filter-status" style="width: 150px;" onchange="filterDaySchedule()">
                            <option value="">전체 상태</option>
                            <option value="CONFIRMED">확정</option>
                            <option value="PENDING">대기</option>
                            <option value="CANCELLED">취소</option>
                            <option value="COMPLETED">완료</option>
                        </select>
                    </div>
                </div>
                <div class="table-container" style="max-height: 500px; overflow-y: auto;">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>날짜</th>
                                <th>시간</th>
                                <th>시설</th>
                                <th>회원</th>
                                <th>인원</th>
                                <th>상태</th>
                                <th>작업</th>
                            </tr>
                        </thead>
                        <tbody id="day-schedule-table-body">
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="App.Modal.close('day-schedule-modal')">닫기</button>
            </div>
        </div>
    </div>
    
    <!-- 메모 템플릿 관리 모달 -->
    <div class="modal-overlay" id="memo-templates-modal">
        <div class="modal" style="max-width: 700px;">
            <div class="modal-header">
                <h2 class="modal-title">메모 템플릿 관리</h2>
                <button class="modal-close">×</button>
            </div>
            <div class="modal-body" id="memo-templates-modal-body">
                <!-- 동적으로 내용이 채워짐 -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="App.Modal.close('memo-templates-modal')">닫기</button>
            </div>
        </div>
    </div>
    
    <script>
        // 페이지별 설정 - 대관은 별도 타입
        window.BOOKING_PAGE_CONFIG = {
            branch: 'RENTAL',
            facilityType: 'RENTAL'
        };
    </script>
    <script src="/js/common.js"></script>
    <script src="/js/rentals.js"></script>
</body>
</html>
